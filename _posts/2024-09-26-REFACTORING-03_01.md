---
title: 03. 리팩터링 - 코드에서 나는 악취 (01-05)
description: 인프런 병행
date: 2024-09-26 +0900
categories: [Study, Refactoring, Inflearn]
tags: [Team Study]
---

## 리팩터링이란
- 기능은 그대로 두면서 내부 구조를 쉽게 이해하고, 변경할 수 있도록 변경하는 것
  - Sw 는 말랑말랑해야한다고~
  - 구조가 너무 딱딱하면 유지보수가 어렵다!
- 처음부터 완벽한 설계는 매우 어렵다(불가능)
- 코드를 작성한 뒤에 구조를 변경하는 일이 발생한다
- 리팩토링으로 애플리케이션의 구조를 꾸준히 개선
- <b>구조 변경으로 인한 버그를 줄이면서 코드를 깔끔하게 유지하는 방법</b>


---
## <b>기이한 이름 / 이해하기 힘든 이름</b>
- 함수, 변수, 클래스, 모듈의 이름 등 모두 어떤 역할을 하는지, 어떻게 쓰이는지 직관적이어야 한다
- 관련 기술 
  - 함수 선언 변경하기 
  - 변수 이름 바꾸기 
  - 필드 이름 바꾸기
  
### 1. 함수 선언 변경하기
- 함수 이름, 매개변수의 변경, 시그니처 변경
- 좋은 이름을 가진 함수는 어떻게 구현되어있는지 코드를 보지 않고 이름만 보고도 이해할 수 있다!!
- 좋은 이름?
  - 함수에 주석을 작성한 다음
  - 주석을 함수 이름으로 만들어 본다
- 함수의 매개변수
  - 함수 내부의 문맥을 결정(전화번호 포멧팅)
    - 텍스트만 넘긴다면 > 여러 객체의 전화번호를 일괄적으로 포멧팅
    - 객체 자체를 넘긴다면 > 그 객체에 한정한 포멧팅
  - 의존성을 결정(payment 만기일 계산)

### 2. 변수 이름 바꾸기
- 더 많이 사용되는 변수일수록 그 이름이 더 중요함
  - 람다식에서 사용하는 변수 vs 함수의 매개변수
- 다이나믹 타입을 지원하는 언어라면 타입을 이름에 넣기도 함
- 처음부터 완전히 fit 한 이름을 짓기는 어려울 수 있으나 리팩토링을 하면서 성격에 맞는 이름으로 변경

### 3. 필드 이름 바꾸기
- 필드는 클리스 이상의 범위에서 사용되기 때문에 네이밍이 특히 중요
- Record 자료구조 : 특정 데이터와 관련있는 필드를 묶어놓은 자료 구조


---
## <b>중복코드</b>
- 단점
  - 비슷한지, 완전히 동일한 코드인지 주의깊게 확인해야 함
  - 코드 변경 시 동일한 모든 곳의 코드 변경이 필요
- 관련 기술
  - 함수 추출 하기(extract function) : 동일한 코드를 여러 메소드에서 사용하는 경우 
  - 코드 분리하기/조정하기(slide statements) : 코드가 비슷하게 생겼지만 완전히 같지는 않은 경우 
  - 메소드 올리기(pull up method) : 여러 하위 클래스에 동일한 코드가 있는 경우(상속 구조에서)

### 4. 함수 추출하기
- “의도” 와 “구현” 분리하기
- 무슨 일을 하는 코드인지 알아내려고 노력해야 하는 코드라면 (구현을 드러내고 있다 > 의도를 분명히 해야함!)
  - 해당 코드를 함수로 분리하고
  - 함수 이름으로 “무슨 일을 하는지” 표현
- 한줄짜리 메소드도 괜찮은가?
  - 의도가 잘 드러난다면 괜찮다.
- 거대한 함수 내의 주석은 추출한 함수를 찾는데 있어서 좋은 단서가 될 수 있다.

### 5. 코드 정리하기
- 관련 있는 코드를 묶어서 코드를 더 쉽게 이해할 수 있도록 함
- 함수에서 사용할 변수는, 변수 사용 코드 바로 위에 선언!
- 관련있는 코드를 묶은 다음, 함수 호출하기를 사용할수도 있음

### 6. 메소드 올리기
- 상속구조에서, 여러 하위 클래스에서 동일한 코드가 있는 경우
- 비슷하지만 일부 값만 다른 경우라면 “함수 매개변수화하기” 리팩토링을 적용한 이후에 이 방법을 사용할 수 있다
- 하위 클래스에 있는 코드가 상위 클래스가 아닌 하위 클래스 기능에 의존하고 있다면 “필드 올리기” 를 적용한 이후에 이 방법을 적용할 수 있다
- 두 메소드가 비슷한 절차를 따르고 있다면 “템플릿 메소드 패턴” 적용을 고려해볼 수 있다

---
## <b>긴 함수</b>
- 짧은 함수 vs 긴 함수
  - 함수가 길 수록 더 이해하기 어려움 vs 짧은 함수는 더 많은 문맥 전환을 필요로함
    - 함수가 길다 ? 코드의 의미가 아닌 구현을 파악하는 시간이 더 많은 경우
    - 가급적이면 작은 함수, 의미 있는 코드와 네이밍을 사용하면 좋지 않을까
- 작은 함수에 좋은 이름을 사용했다면 함수의 코드를 보지 않고도 이해할 수 있다
- 코드에 주석을 남기고 싶다면, 주석 대신 함수를 만들고 함수의 이름으로 “의도” 를 표현해보자

- 관련 기술
  - 함수 추출하기(extract method)
  - 임시 변수를 질의 함수로 바꾸기(replace temp with query), 매개변수 객체 만들기(introduce parameter object), 객체 통째로 넘기기(preserve whole object)
    - 함수를 분리하면서 전달해야하는 매개변수가 많은 경우
  - 조건문 분해하기(decompose conditional)
  - 다형성으로 바꾸기(replace conditional with polymorphism) : 같은 조건으로 여러개의 switch 문이 있는 경우 
  - 반복문 쪼개기(split loop): 반복문 안에서 여러 작업을 하고 있어서 하나의 메소드로 추출하기 어려운 경우 

### 7. 임시 변수를 질의 함수로 바꾸기 
- 임시 변수를 사용하는 대신, 임시 변수 값을 리턴하는 함수로 만드는 것!
  - 임시변수도 리팩토링 기법이지만, 임시변수로 매개변수가 많아지는 경우 고려해볼 방법
- <b>긴 함수를 리팩토링할 때, 그러한 임시 변수를 함수 추출로 분리한다면 빼낸 함수로 전달해야 할 매개변수를 줄일 수 있다 </b>

### 8. 매개변수 객체 만들기 
- 같은 매개변수들이 여러 메소드에 걸쳐 나타난다 -> 매우 중요한 코드 냄새~^<^
- 그러한 매개변수를 묶어 하나의 자료구조로 만든다면
  - 데이터간의 관계가 명시적으로 드러남
  - 함수의 매개변수 개수를 줄일 수 있음
  - 도메인을 이해하는데 중요한 역할을 하는 클래스로 발전할 수 있음

### 9. 객체를 통째로 넘기기 
- 어떤 한 레코드에서 구할 수 있는 값들을 함수에 전달하는 경우, 해당 매개변수를 레코드 하나로 교체할 수 있다
- 매개변수 목록을 줄일 수 있음
- 그러나 의존성에 대한 고려가 필요
- 어쩌면 메소드의 위치가 적절하지 않을 수 있다(기능 편애 “feature envy" (냄새에 해당)

### 10. 함수를 명령으로 바꾸기 
- 함수를 독립적 객체인, Command 로 만들어 사용할 수 있음
  - Operation 하나를 갖는 패턴
- 장점
  - 부가적인 기능으로 undo 기능 생성이 가능
  - 더 복잡한 기능을 수행하는데 필요한 여러 메소드 추가 가능
  - 상속이나 템플릿 활용이 가능
  - 복잡한 메소드를 여러 메소드나 필드를 활용해 쪼갤 수 있다
- 대부분 커맨드 보다 함수를 사용하지만, 커맨드 말고 다른 방법이 없는 경우에만 사용

### 11. 조건문 분해하기
- “함수 추출하기” 를 통해 조건의 의도를 드러냄

### 12. 반복문 쪼개기
- 하나의 반복문에 여러 다른 작업을 하는 코드를 쉽게 찾아볼 수 있다
  - 해당 반복문을 수정할 대 여러 작업을 모두 고려하며 코딩해야 함
  - 하나의 반복문이 하나의 동작만 하도록
- 반복문을 여러개로 쪼개 보다 쉽게 이해하고 수정할 수 있게 함
- 성능 문제를 야기할 순 있지만
  - 리팩토링 != 성능 최적화
  - 리팩토링 후에 성능 최적화를 시도할 수 있다

---
## <b>긴 매개변수 목록</b>
- 함수의 매개변수가 많을수록 함수의 역할을 이해하기 어려워진다
  - 한가지 일을 하는게 맞나?
  - 다 필요한가?
  - 레코드로 뭉칠 순 없나?
- 관련 기술
  - 매개변수를 질의 함수로 바꾸기(Replace parameter with Query)
    - 어떤 매개변수를 다른 매개변수를 통해 알아낼 수 있는 경우
  - 객체 통째로 넘기기(Preserve Whole Object)
  - 매개변수 객체 만들기(Introduce Parameter Object)
    - 일부 매개변수들이 대부분 같이 넘겨지는 경우
  - 플래그 인수 제거하기(Remove Flag Argument)
    - 매개변수가 플래그로 사용되는 경우
  - 여러 함수를 클래스로 묶기(Combine Funtions into Class)
    - 여러 함수가 일부 매개변수를 공통적으로 사용하는 경우
    - 매개변수를 클래스 필드로 만들어 매개변수 목록을 줄임

### 14. 매개변수를 질의 함수로 바꾸기
- 어떤 매개변수를 다른 매개변수를 통해 알아낼 수 있는 경우
  - 중복된 매개변수 제거!
- 매개변수 전달하는 것은 함수 호출하는 쪽의 책임 : 함수 호출하는 쪽의 책임을 줄이고 함수 내부에서 책임지도록 하자
- 임시 변수를 질의 함수로 바꾸기 + 함수 선언 변경하기

### 15. 플래그 인수 제거하기
- 플래그 : 주로 함수 내부의 로직 분기하는데 사용
- 플래그를 사용한 함수는 차이를 파악하기 힘들다
  - 로직을 다 봐야만 이해할 수 있기 때문에
- 조건문 분해하기 를 활용할 수 았음

### 16. 여러 함수를 클래스로 묶기
- 비슷한 매개변수 목록을 여러 함수에서 사용하고 있다면 해당 메소드를 모아서 클래스를 만들 수 있다
- 클래스 내부 메소드를 옮기고 데이터를 필드로 만들어 전달해야 하는 매개변수 목록을 줄임


---
## <b>전역데이터</b>
- Public static
  - 아무곳에서나 변경될 수 있다는 문제
  - 변경지점을 파악하기 어렵다
- 클래스 변수 (필드)도 비슷한 문제
- 관련 기술
  - 변수 캡슐화하기(Encapsulate Variable) : 접근을 제어하거나 어디서 사용하는지 쉽게 파악할 수 있도록 함

